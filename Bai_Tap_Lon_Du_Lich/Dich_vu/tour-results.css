<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kết Quả Tìm Kiếm Tour - Travel Explorer</title>
    <link rel="stylesheet" href="assets/css/index.css">
    <link rel="stylesheet" href="assets/css/tour-results.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>

<header class="header">
    <div class="container nav-container">
        <a href="main.html" class="logo">Travel Explorer</a>
        <div class="hamburger-menu"><i class="fas fa-bars"></i></div>
        <ul class="nav-menu">
            <li><a href="main.html" class="nav-link">Trang Chủ</a></li>
            <li><a href="tour.html" class="nav-link active">Tour</a></li>
            <li><a href="hotel.html" class="nav-link">Khách Sạn</a></li>
            <li><a href="flight.html" class="nav-link">Vé Máy Bay</a></li>
        </ul>
    </div>
</header>

<!-- Thanh tìm kiếm -->
<section class="search-section">
    <div class="container">
        <form id="tourSearchForm" class="search-form-elegant">
            <div class="search-input-group">
                <i class="fas fa-map-marker-alt"></i>
                <input type="text" id="location" placeholder="Bạn muốn đi đâu?">
            </div>
            <div class="search-input-group">
                <i class="fas fa-calendar-alt"></i>
                <input type="date" id="date">
            </div>
            <div class="search-input-group">
                <i class="fas fa-clock"></i>
                <select id="duration">
                    <option value="">Số ngày</option>
                    <option value="1-3">1-3 ngày</option>
                    <option value="4-7">4-7 ngày</option>
                    <option value="8-14">8-14 ngày</option>
                    <option value="15+">15+ ngày</option>
                </select>
            </div>
            <button type="submit" class="search-btn">
                <i class="fas fa-search"></i> Tìm Tour
            </button>
        </form>
    </div>
</section>

<main class="main-container container">
    <aside class="sidebar">
        <h3><i class="fas fa-sliders-h"></i> Bộ Lọc Tìm Kiếm</h3>
        <div class="filter-group">
            <h4>Khoảng Giá</h4>
            <label><input type="checkbox" name="price" value="<10"> Dưới 10 triệu</label>
            <label><input type="checkbox" name="price" value="10-20"> 10 - 20 triệu</label>
            <label><input type="checkbox" name="price" value="20-50"> 20 - 50 triệu</label>
            <label><input type="checkbox" name="price" value="50+"> Trên 50 triệu</label>
        </div>
        <div class="filter-group">
            <h4>Loại Tour</h4>
            <label><input type="checkbox" name="type" value="domestic"> Nội Địa</label>
            <label><input type="checkbox" name="type" value="international"> Quốc Tế</label>
        </div>
        <div class="filter-group">
            <h4>Số Ngày</h4>
            <label><input type="checkbox" name="duration_filter" value="1-3"> 1-3 ngày</label>
            <label><input type="checkbox" name="duration_filter" value="4-7"> 4-7 ngày</label>
            <label><input type="checkbox" name="duration_filter" value="8-14"> 8-14 ngày</label>
            <label><input type="checkbox" name="duration_filter" value="15+"> 15+ ngày</label>
        </div>
        <button class="apply-btn">Áp Dụng Bộ Lọc</button>
    </aside>

    <section class="results-section">
        <div class="results-header">
            <h2 id="resultInfo">Đang tìm tour phù hợp...</h2>
            <select id="sortBy">
                <option value="default">Khởi hành sớm nhất</option>
                <option value="price-asc">Giá tăng dần</option>
                <option value="price-desc">Giá giảm dần</option>
                <option value="duration-asc">Số ngày ngắn → dài</option>
            </select>
        </div>

        <div class="tour-grid" id="tourListGrid"></div>
    </section>
</main>

<!-- MODAL ĐẶT TOUR -->
<div id="tourModal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <div class="modal-header">
            <h3>ĐẶT TOUR: <span id="modalTourName"></span></h3>
        </div>
        <div class="modal-body">
            <form id="bookingForm">
                <input type="hidden" id="tName">

                <div class="form-grid">
                    <div class="input-group">
                        <label>Họ và tên <span class="required">*</span></label>
                        <input type="text" id="fullName" required placeholder="Nguyễn Văn A">
                    </div>
                    <div class="input-group">
                        <label>Số điện thoại <span class="required">*</span></label>
                        <input type="tel" id="phone" required placeholder="0901234567">
                    </div>
                </div>

                <div class="form-grid">
                    <div class="input-group">
                        <label>Ngày khởi hành mong muốn <span class="required">*</span></label>
                        <input type="date" id="departDate" required>
                    </div>
                    <div class="input-group">
                        <label>Email <span class="required">*</span></label>
                        <input type="email" id="email" required placeholder="example@gmail.com">
                    </div>
                </div>

                <div class="form-grid">
                    <div class="input-group">
                        <label>Số người lớn <span class="required">*</span></label>
                        <input type="number" id="adults" value="1" min="1" required>
                    </div>
                    <div class="input-group">
                        <label>Số trẻ em (2-11 tuổi)</label>
                        <input type="number" id="children" value="0" min="0">
                    </div>
                </div>

                <div class="input-group full-width">
                    <label>Yêu cầu thêm (không bắt buộc)</label>
                    <textarea id="notes" rows="3" placeholder="Ví dụ: Phòng view biển, ăn chay, xe đưa đón sân bay..."></textarea>
                </div>

                <div class="modal-agree">
                    <label><input type="checkbox" id="agree" required> Tôi đồng ý với <a href="#" style="color:var(--primary); text-decoration:underline;">điều khoản đặt tour</a> <span class="required">*</span></label>
                </div>

                <button type="submit" class="submit-btn">GỬI YÊU CẦU ĐẶT TOUR</button>
            </form>
            <p id="bookingMessage" class="booking-message"></p>
        </div>
    </div>
</div>

<script>
// DỮ LIỆU TOUR
const tourData = [
    { name: "Sapa - Fansipan 3N2Đ", location: "Sapa", duration: 3, price: 4900000, rating: 4.8, departure: "2025-12-15", type: "domestic", hot: true, image: "https://images.unsplash.com/photo-1579549303273-51834927b521?w=800", desc: "Cáp treo chinh phục nóc nhà Đông Dương, bản Cát Cát, ruộng bậc thang mùa lúa chín." },
    { name: "Phú Quốc 4N3Đ - Vinpearl Safari", location: "Phú Quốc", duration: 4, price: 8900000, rating: 4.9, departure: "2025-12-20", type: "domestic", hot: true, image: "https://images.unsplash.com/photo-1583417319079-28936b75d9b0?w=800", desc: "Resort 5 sao, safari lớn nhất Việt Nam, cáp treo vượt biển dài nhất thế giới." },
    { name: "Đà Nẵng - Hội An - Bà Nà 4N3Đ", location: "Đà Nẵng", duration: 4, price: 6900000, rating: 4.7, departure: "2025-12-18", type: "domestic", image: "https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=800", desc: "Cầu Vàng nổi tiếng thế giới, phố cổ đèn lồng, biển Mỹ Khê, Fantasy Park." },
    { name: "Hạ Long 2N1Đ - Du thuyền 5 sao", location: "Hạ Long", duration: 2, price: 5900000, rating: 5.0, departure: "2025-12-25", type: "domestic", hot: true, image: "https://images.unsplash.com/photo-1587502536575-6a8c8c98c5da?w=800", desc: "Ngủ đêm trên vịnh di sản, hang Sửng Sốt, chèo kayak, tắm biển Titop." },
    { name: "Hàn Quốc 5N4Đ - Seoul & Jeju", location: "Hàn Quốc", duration: 5, price: 21900000, rating: 4.9, departure: "2025-12-30", type: "international", image: "https://images.unsplash.com/photo-1536440136628-849c177e375a?w=800", desc: "Đảo Nami lãng mạn, Seoul Tower, đảo Jeju - thiên đường nghỉ dưỡng." },
    { name: "Nhật Bản 6N5Đ - Tokyo & Fuji", location: "Nhật Bản", duration: 6, price: 39900000, rating: 5.0, departure: "2026-03-20", type: "international", image: "https://images.unsplash.com/photo-1540959733332-1b0bd6e6d2f7?w=800", desc: "Mùa hoa anh đào, núi Phú Sĩ huyền thoại, Tokyo Disneyland." },
    { name: "Thái Lan 5N4Đ - Bangkok & Pattaya", location: "Thái Lan", duration: 5, price: 13900000, rating: 4.8, departure: "2025-12-26", type: "international", hot: true, image: "https://images.unsplash.com/photo-1552465011-6b1166f9a1e6?w=800", desc: "Chợ nổi Damnoen Saduak, đảo san hô Coral, show Alcazar hoành tráng." },
    { name: "Châu Âu 10N9Đ - Pháp & Ý & Thụy Sĩ", location: "Châu Âu", duration: 10, price: 69900000, rating: 5.0, departure: "2026-01-05", type: "international", image: "https://images.unsplash.com/photo-1519904981064-b0cfaffc987c?w=800", desc: "Paris - Tháp Eiffel, Rome - Vatican, Zurich - hồ Lucerne thơ mộng." },
    { name: "Singapore 4N3Đ - Marina Bay Sands", location: "Singapore", duration: 4, price: 18900000, rating: 4.9, departure: "2025-12-28", type: "international", image: "https://images.unsplash.com/photo-1516496636080-14c91f75a9be?w=800", desc: "Khách sạn hồ bơi vô cực nổi tiếng, Universal Studio, Garden by the Bay." },
    { name: "Đà Lạt 3N2Đ - Mùa Hoa Phượng Tím", location: "Đà Lạt", duration: 3, price: 3900000, rating: 4.7, departure: "2025-12-16", type: "domestic", image: "https://images.unsplash.com/photo-1582510003544-4d00b7f621f5?w=800", desc: "Thành phố ngàn hoa, đồi chè trái tim, cà phê view núi cực chill." }
];

function formatPrice(p) { return p.toLocaleString('vi-VN') + '₫'; }

function createTourCard(t) {
    const hot = t.hot ? '<div class="badge-hot">HOT DEAL</div>' : '';
    return `
        <div class="tour-card">
            ${hot}
            <div class="tour-image">
                <img src="${t.image}" alt="${t.name}">
            </div>
            <div class="tour-content">
                <h3 class="tour-title">${t.name}</h3>
                <p class="tour-desc">${t.desc}</p>
                <div class="tour-meta">
                    <span><i class="fas fa-map-marker-alt"></i> ${t.location}</span>
                    <span><i class="fas fa-clock"></i> ${t.duration} ngày</span>
                    <span><i class="fas fa-calendar-alt"></i> ${new Date(t.departure).toLocaleDateString('vi-VN')}</span>
                </div>
                <div class="tour-footer">
                    <div class="tour-rating">
                        <i class="fas fa-star"></i> ${t.rating}
                    </div>
                    <div class="tour-price-info">
                        <div class="price-label">Chỉ từ</div>
                        <div class="price">${formatPrice(t.price)}</div>
                    </div>
                    <button class="book-btn open-modal-tour" data-name="${t.name}">Đặt Ngay</button>
                </div>
            </div>
        </div>
    `;
}

function isPriceInRange(price, ranges) {
    if (ranges.length === 0) return true;
    for (const r of ranges) {
        if (r === '<10' && price < 10000000) return true;
        if (r === '10-20' && price >= 10000000 && price <= 20000000) return true;
        if (r === '20-50' && price > 20000000 && price <= 50000000) return true;
        if (r === '50+' && price > 50000000) return true;
    }
    return false;
}

function isDurationInRange(dur, ranges) {
    if (ranges.length === 0) return true;
    for (const r of ranges) {
        if (r === '1-3' && dur <= 3) return true;
        if (r === '4-7' && dur >= 4 && dur <= 7) return true;
        if (r === '8-14' && dur >= 8 && dur <= 14) return true;
        if (r === '15+' && dur >= 15) return true;
    }
    return false;
}

// ===== HÀM CHÍNH: ĐỌC URL VÀ RENDER KẾT QUẢ =====
function renderResults() {
    let result = [...tourData];
    
    // Đọc giá trị từ form (sau khi submit)
    const query = document.getElementById('location').value.trim().toLowerCase();
    
    // Đọc giá trị từ checkbox/select
    const prices = Array.from(document.querySelectorAll('input[name="price"]:checked')).map(i => i.value);
    const types = Array.from(document.querySelectorAll('input[name="type"]:checked')).map(i => i.value);
    const durations = Array.from(document.querySelectorAll('input[name="duration_filter"]:checked')).map(i => i.value);
    const sort = document.getElementById('sortBy').value;

    // Lọc theo location
    if (query) {
        result = result.filter(t => 
            t.name.toLowerCase().includes(query) || 
            t.location.toLowerCase().includes(query)
        );
    }
    
    // Lọc theo type (domestic/international)
    if (types.length) {
        result = result.filter(t => types.includes(t.type));
    }
    
    // Lọc theo giá
    result = result.filter(t => isPriceInRange(t.price, prices));
    
    // Lọc theo duration
    result = result.filter(t => isDurationInRange(t.duration, durations));

    // Sắp xếp
    if (sort === 'price-asc') result.sort((a,b) => a.price - b.price);
    else if (sort === 'price-desc') result.sort((a,b) => b.price - a.price);
    else if (sort === 'duration-asc') result.sort((a,b) => a.duration - b.duration);
    else result.sort((a,b) => new Date(a.departure) - new Date(b.departure));

    // Hiển thị kết quả
    document.getElementById('resultInfo').textContent = result.length 
        ? `Tìm thấy ${result.length} tour phù hợp` 
        : 'Không tìm thấy tour nào';
        
    document.getElementById('tourListGrid').innerHTML = result.length 
        ? result.map(createTourCard).join('') 
        : '<p class="no-results">Không có tour nào phù hợp với bộ lọc của bạn.</p>';

    // Gắn sự kiện mở modal cho các button mới
    document.querySelectorAll('.open-modal-tour').forEach(btn => {
        btn.onclick = function() {
            const name = this.dataset.name;
            document.getElementById('tName').value = name;
            document.getElementById('modalTourName').textContent = name;
            document.getElementById('tourModal').classList.add('active');
        };
    });
}

// ===== ĐỌC URL PARAMETERS KHI LOAD TRANG =====
function loadFromURL() {
    const urlParams = new URLSearchParams(window.location.search);
    const locationParam = urlParams.get('location');
    
    // Điền vào ô input nếu có parameter
    if (locationParam) {
        document.getElementById('location').value = locationParam;
    }
    
    // Render kết quả ngay lập tức
    renderResults();
}

// ===== SỰ KIỆN KHI TRANG LOAD =====
document.addEventListener('DOMContentLoaded', () => {
    // Load kết quả từ URL khi vào trang
    loadFromURL();
    
    // Xử lý form tìm kiếm
    document.getElementById('tourSearchForm').onsubmit = e => { 
        e.preventDefault(); 
        renderResults(); 
    };
    
    // Xử lý thay đổi bộ lọc
    document.querySelectorAll('input[type="checkbox"], #sortBy').forEach(el => {
        el.addEventListener('change', renderResults);
    });
    
    // Xử lý nút "Áp dụng bộ lọc"
    document.querySelector('.apply-btn').addEventListener('click', renderResults);
});

// ===== XỬ LÝ MODAL =====
document.querySelector('.close-btn').onclick = () => {
    document.getElementById('tourModal').classList.remove('active');
};

window.onclick = e => { 
    if (e.target === document.getElementById('tourModal')) {
        document.getElementById('tourModal').classList.remove('active');
    }
};

document.getElementById('bookingForm').onsubmit = function(e) {
    e.preventDefault();
    const msg = document.getElementById('bookingMessage');
    msg.textContent = 'Đặt tour thành công! Chúng tôi sẽ liên hệ ngay.';
    msg.style.color = '#10b981';
    msg.style.display = 'block';
    
    setTimeout(() => {
        msg.style.display = 'none';
        this.reset();
        document.getElementById('tourModal').classList.remove('active');
    }, 3000);
};

// ===== XỬ LÝ HAMBURGER MENU =====
document.querySelector('.hamburger-menu').addEventListener('click', () => {
    document.querySelector('.nav-menu').classList.toggle('active');
});
</script>
<script>
// Mở modal
document.querySelectorAll('.open-modal-tour').forEach(btn => {
    btn.onclick = function() {
        const name = this.dataset.name;
        document.getElementById('tName').value = name;
        document.getElementById('modalTourName').textContent = name;
        document.getElementById('tourModal').classList.add('active');
    };
});

// Đóng modal
document.querySelector('.close-btn').onclick = () => 
    document.getElementById('tourModal').classList.remove('active');

window.onclick = e => {
    if (e.target === document.getElementById('tourModal'))
        document.getElementById('tourModal').classList.remove('active');
};

// Xử lý đặt tour
document.getElementById('bookingForm').onsubmit = function(e) {
    e.preventDefault();

    const msg = document.getElementById('bookingMessage');
    msg.textContent = 'Đặt tour thành công! Chúng tôi sẽ liên hệ ngay trong vài phút.';
    msg.style.color = '#10b981';
    msg.style.display = 'block';

    setTimeout(() => {
        this.reset();
        msg.style.display = 'none';
        document.getElementById('tourModal').classList.remove('active');
    }, 3000);
};
</script>
<section class="suggested-tours-section container">
        <h2 class="section-title" style="text-align: center; margin: 4rem 0 2.5rem; color: #4361ee;">
            <i class="fas fa-fire"></i> Tour Đang Hot - Khách Đặt Nhiều Nhất
        </h2>
        <p style="text-align: center; color: #64748b; margin-bottom: 3rem; font-size: 1.1rem;">
            Những hành trình được hàng ngàn khách yêu thích trong tháng này
        </p>

        <div class="tour-card-grid" id="suggestedTours">
        </div>
    </section>

    <!-- ==================== FORM LIÊN HỆ CHÚNG TÔI ==================== -->
<section class="contact-tour-section">
    <div class="container contact-tour-content">
        <div class="contact-info">
            <h2>CẦN TƯ VẤN TOUR RIÊNG?</h2>
            <p>Hãy để lại thông tin, chuyên viên du lịch của chúng tôi sẽ liên hệ lại với bạn trong vòng 30 phút để thiết kế hành trình hoàn hảo cho bạn.</p>
            <ul>
                <li><i class="fas fa-phone"></i> **Hotline:** 1900 6789</li>
                <li><i class="fas fa-envelope"></i> **Email:** support@travelexplorer.com</li>
                <li><i class="fas fa-map-marker-alt"></i> **Văn phòng:** 123 Đường Du Lịch, Quận 1, TP. HCM</li>
            </ul>
        </div>
        <div class="contact-form-wrapper">
            <h3>Gửi Yêu Cầu Tư Vấn</h3>
            <form id="contactForm">
                <div class="form-group">
                    <label for="cName">Họ và Tên (*)</label>
                    <input type="text" id="cName" name="cName" required>
                </div>
                <div class="form-group">
                    <label for="cEmail">Email (*)</label>
                    <input type="email" id="cEmail" name="cEmail" required>
                </div>
                <div class="form-group">
                    <label for="cPhone">Số Điện Thoại (*)</label>
                    <input type="tel" id="cPhone" name="cPhone" required>
                </div>
                <div class="form-group">
                    <label for="cDestination">Điểm Đến Yêu Thích</label>
                    <input type="text" id="cDestination" name="cDestination" placeholder="Ví dụ: Phú Quốc, Châu Âu...">
                </div>
                <div class="form-group">
                    <label for="cMessage">Nội Dung Yêu Cầu</label>
                    <textarea id="cMessage" name="cMessage" rows="4" placeholder="Bạn muốn đi bao nhiêu người? Thời gian nào?"></textarea>
                </div>
                <button type="submit" class="cta-button">Gửi Yêu Cầu</button>
            </form>
            <p id="formMessage" style="text-align: center; margin-top: 15px; display: none; color: var(--main-color); font-weight: bold;"></p>
        </div>
    </div>
</section>
    <script>
const suggestedTours = [
    { name: "Phú Quốc 3N3Đ - Vinpearl Safari + Cáp Treo", price: "6.990.000", duration: "3 ngày 3 đêm", img: "https://images.unsplash.com/photo-1577717904356-3058c23b7e91?w=800" },
    { name: "Đà Lạt Mộng Mơ - 3N3Đ Khởi Hành Hàng Ngày", price: "4.590.000", duration: "3 ngày 3 đêm", img: "https://images.unsplash.com/photo-1583417136848-9ddde675c98a?w=800" },
    { name: "Hà Nội - Hạ Long - Ninh Bình 4N4Đ", price: "8.890.000", duration: "4 ngày 4 đêm", img: "https://images.unsplash.com/photo-1570545906912-2dd4a9e7d5bb?w=800" },
    { name: "Singapore - Malaysia 5N4Đ Bay Vietnam Airlines", price: "15.990.000", duration: "5 ngày 4 đêm", img: "https://images.unsplash.com/photo-1516496636080-14c9a69611f8?w=800" },
    { name: "Hàn Quốc Mùa Thu Lá Đỏ 5N5Đ", price: "22.990.000", duration: "5 ngày 5 đêm", img: "https://images.unsplash.com/photo-1542272209-6d40db738c20?w=800" },
    { name: "Châu Âu 4 Nước: Pháp - Thụy Sĩ - Ý - Vatican", price: "69.900.000", duration: "10 ngày 9 đêm", img: "https://images.unsplash.com/photo-1519904981063-bfd50b734b1e?w=800" }
];

function getUrlParams() {
    const params = new URLSearchParams(window.location.search);
    return { q: (params.get('q') || '').trim() };
    }

// Hàm tạo card tour gợi ý
function createSuggestedCard(tour) {
    return `
        <div class="tour-card open-modal-tour" data-name="${tour.name}">
            <img src="${tour.img}" alt="${tour.name}">
            <div class="tour-card-content">
                <h3>${tour.name}</h3>
                <p class="duration"><i class="fas fa-clock"></i> ${tour.duration}</p>
                <p class="price">Chỉ từ <strong>${tour.price}₫</strong>/khách</p>
                <button class="btn-book">ĐẶT NGAY</button>
            </div>
        </div>
    `;
}

// Hiển thị tour gợi ý khi trang tải xong hoặc sau khi tìm kiếm
function loadSuggestedTours() {
    const container = document.getElementById('suggestedTours');
    if (container) {
        container.innerHTML = suggestedTours.map(createSuggestedCard).join('');
        
        // Gắn lại sự kiện mở modal cho các tour gợi ý
        document.querySelectorAll('#suggestedTours .open-modal-tour').forEach(btn => {
            btn.onclick = function() {
                const name = this.dataset.name;
                document.getElementById('tName').value = name;
                document.getElementById('modalTourName').textContent = name;
                document.getElementById('tourModal').classList.add('active');
            };
        });
    }
}

// Tự động cuộn xuống kết quả sau khi tìm kiếm
function scrollToResults() {
    document.querySelector('.main-container').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// Gọi hàm khi trang tải xong và sau mỗi lần tìm kiếm
document.addEventListener('DOMContentLoaded', () => {
    loadSuggestedTours();
    // Override lại hàm renderResults cũ để cuộn mượt
    const originalRender = renderResults;
    window.renderResults = function() {
        originalRender();
        setTimeout(scrollToResults, 300);
        loadSuggestedTours(); // Cập nhật lại sự kiện modal
    };
});

// Xử lý form liên hệ
document.getElementById('contactForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formMessage = document.getElementById('formMessage');
        formMessage.style.display = 'block';
        formMessage.style.color = 'green';
        formMessage.textContent = 'Yêu cầu của bạn đã được gửi thành công! Chúng tôi sẽ liên hệ lại sớm nhất.';
        
        // --- PHẦN CẦN THÊM/THAY ĐỔI ---
        this.reset(); // Dùng `this` để reset form hiện tại
        // -----------------------------

        setTimeout(() => {
            formMessage.style.display = 'none';
        }, 5000);
    });
    document.querySelector('.hamburger-menu').addEventListener('click', () => document.querySelector('.nav-menu').classList.toggle('active'));
    window.onclick = e => { if (e.target === document.getElementById('tourModal')) document.getElementById('tourModal').classList.remove('active'); };
</script>
</body>
</html>
